<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nest.js学习（一） | 凌烟</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://fang-kang.gitee.io/blog-img/favicon.ico">
    <meta name="description" content="stay true to the mission.">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.c0543776.css" as="style"><link rel="preload" href="/assets/js/app.4aa0e8ea.js" as="script"><link rel="preload" href="/assets/js/4.3a6b897f.js" as="script"><link rel="preload" href="/assets/js/1.97f2804a.js" as="script"><link rel="preload" href="/assets/js/2.13201674.js" as="script"><link rel="preload" href="/assets/js/41.24ea1bda.js" as="script"><link rel="prefetch" href="/assets/js/10.956d5498.js"><link rel="prefetch" href="/assets/js/11.251f530d.js"><link rel="prefetch" href="/assets/js/12.d01bf345.js"><link rel="prefetch" href="/assets/js/13.bb070dff.js"><link rel="prefetch" href="/assets/js/14.b543585c.js"><link rel="prefetch" href="/assets/js/15.b1bcf849.js"><link rel="prefetch" href="/assets/js/16.43b94681.js"><link rel="prefetch" href="/assets/js/17.aa1e97c6.js"><link rel="prefetch" href="/assets/js/18.aa235895.js"><link rel="prefetch" href="/assets/js/19.10a3cdf0.js"><link rel="prefetch" href="/assets/js/20.a125aaa0.js"><link rel="prefetch" href="/assets/js/21.9e6ce220.js"><link rel="prefetch" href="/assets/js/22.9b80c541.js"><link rel="prefetch" href="/assets/js/23.0e9e503f.js"><link rel="prefetch" href="/assets/js/24.fcded96a.js"><link rel="prefetch" href="/assets/js/25.6a74bbbd.js"><link rel="prefetch" href="/assets/js/26.92b3b14a.js"><link rel="prefetch" href="/assets/js/27.18fb41d5.js"><link rel="prefetch" href="/assets/js/28.1d8217aa.js"><link rel="prefetch" href="/assets/js/29.910249cb.js"><link rel="prefetch" href="/assets/js/30.7ffd4cf7.js"><link rel="prefetch" href="/assets/js/31.e5afbb5b.js"><link rel="prefetch" href="/assets/js/32.796285aa.js"><link rel="prefetch" href="/assets/js/33.4042bf41.js"><link rel="prefetch" href="/assets/js/34.b887e798.js"><link rel="prefetch" href="/assets/js/35.cf4833c1.js"><link rel="prefetch" href="/assets/js/36.1d919a3c.js"><link rel="prefetch" href="/assets/js/37.4c63b466.js"><link rel="prefetch" href="/assets/js/38.4f2abbf2.js"><link rel="prefetch" href="/assets/js/39.663ea2e3.js"><link rel="prefetch" href="/assets/js/40.99d7fef1.js"><link rel="prefetch" href="/assets/js/42.5ae1c9f5.js"><link rel="prefetch" href="/assets/js/43.61430462.js"><link rel="prefetch" href="/assets/js/44.95389ae8.js"><link rel="prefetch" href="/assets/js/45.e94972fb.js"><link rel="prefetch" href="/assets/js/46.4abcad03.js"><link rel="prefetch" href="/assets/js/47.5022029f.js"><link rel="prefetch" href="/assets/js/48.15206369.js"><link rel="prefetch" href="/assets/js/49.54505c66.js"><link rel="prefetch" href="/assets/js/5.32ec8265.js"><link rel="prefetch" href="/assets/js/50.cdc116d4.js"><link rel="prefetch" href="/assets/js/51.e6b2bae7.js"><link rel="prefetch" href="/assets/js/52.88cfc911.js"><link rel="prefetch" href="/assets/js/53.ea97ed47.js"><link rel="prefetch" href="/assets/js/54.636e88d0.js"><link rel="prefetch" href="/assets/js/55.ad5ebf00.js"><link rel="prefetch" href="/assets/js/56.68db72c1.js"><link rel="prefetch" href="/assets/js/57.e92d20ec.js"><link rel="prefetch" href="/assets/js/58.f1a79bf1.js"><link rel="prefetch" href="/assets/js/59.80f3636b.js"><link rel="prefetch" href="/assets/js/6.22876f96.js"><link rel="prefetch" href="/assets/js/60.5676553a.js"><link rel="prefetch" href="/assets/js/61.823d8bbc.js"><link rel="prefetch" href="/assets/js/62.3ea4862d.js"><link rel="prefetch" href="/assets/js/63.1db0a1d6.js"><link rel="prefetch" href="/assets/js/64.5808862e.js"><link rel="prefetch" href="/assets/js/65.9539285b.js"><link rel="prefetch" href="/assets/js/66.a50ff9e7.js"><link rel="prefetch" href="/assets/js/67.03936b73.js"><link rel="prefetch" href="/assets/js/68.3cbbbf1e.js"><link rel="prefetch" href="/assets/js/69.54b2e54e.js"><link rel="prefetch" href="/assets/js/7.06eda39e.js"><link rel="prefetch" href="/assets/js/8.d5a33fd8.js"><link rel="prefetch" href="/assets/js/9.0c4df056.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0543776.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-04b97590><div data-v-04b97590><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-04b97590 data-v-04b97590><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-2a121430 data-v-04b97590 data-v-04b97590><h3 class="title" style="display:none;" data-v-2a121430 data-v-2a121430>凌烟</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-2a121430 data-v-2a121430><input type="password" value="" data-v-2a121430> <span data-v-2a121430>Konck! Knock!</span> <button data-v-2a121430>OK</button></label> <div class="footer" style="display:none;" data-v-2a121430 data-v-2a121430><span data-v-2a121430><i class="iconfont reco-theme" data-v-2a121430></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2a121430>vuePress-theme-reco</a></span> <span data-v-2a121430><i class="iconfont reco-copyright" data-v-2a121430></i> <a data-v-2a121430><span data-v-2a121430>Fk</span>
            
          <span data-v-2a121430>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-04b97590><header class="navbar" data-v-04b97590><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://fang-kang.gitee.io/blog-img/head.jpg" alt="凌烟" class="logo"> <span class="site-name">凌烟</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Js/" class="nav-link"><i></i>
  Js
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/mongodb/" class="nav-link"><i></i>
  mongodb
</a></li><li class="dropdown-item"><!----> <a href="/categories/其他/" class="nav-link"><i></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniApp/" class="nav-link"><i></i>
  uniApp
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i></i>
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/views/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      学习手册
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/es6" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  Es6
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/ts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/vue3.0" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  Vue3.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/node" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  Node
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fang-kang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/fang-kang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-04b97590></div> <aside class="sidebar" data-v-04b97590><div class="personal-info-wrapper" data-v-5641b559 data-v-04b97590><img src="https://fang-kang.gitee.io/blog-img/head.jpg" alt="author-avatar" class="personal-img" data-v-5641b559> <h3 class="name" data-v-5641b559>
    Fk
  </h3> <div class="num" data-v-5641b559><div data-v-5641b559><h3 data-v-5641b559>47</h3> <h6 data-v-5641b559>Article</h6></div> <div data-v-5641b559><h3 data-v-5641b559>19</h3> <h6 data-v-5641b559>Tag</h6></div></div> <hr data-v-5641b559></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Js/" class="nav-link"><i></i>
  Js
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/mongodb/" class="nav-link"><i></i>
  mongodb
</a></li><li class="dropdown-item"><!----> <a href="/categories/其他/" class="nav-link"><i></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniApp/" class="nav-link"><i></i>
  uniApp
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i></i>
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/views/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      学习手册
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/es6" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  Es6
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/ts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  TypeScript
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/vue3.0" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  Vue3.0
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fang-kang.gitee.io/node" target="_blank" rel="noopener noreferrer" class="nav-link external"><i></i>
  Node
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      联系我
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fang-kang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/fang-kang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-2a121430 data-v-04b97590><h3 class="title" style="display:none;" data-v-2a121430 data-v-2a121430>nest.js学习（一）</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-2a121430 data-v-2a121430><input type="password" value="" data-v-2a121430> <span data-v-2a121430>Konck! Knock!</span> <button data-v-2a121430>OK</button></label> <div class="footer" style="display:none;" data-v-2a121430 data-v-2a121430><span data-v-2a121430><i class="iconfont reco-theme" data-v-2a121430></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-2a121430>vuePress-theme-reco</a></span> <span data-v-2a121430><i class="iconfont reco-copyright" data-v-2a121430></i> <a data-v-2a121430><span data-v-2a121430>Fk</span>
            
          <span data-v-2a121430>2020 - </span>
          2021
        </a></span></div></div> <div data-v-04b97590><main class="page"><div class="page-title" style="display:none;"><h1 class="title">nest.js学习（一）</h1> <div data-v-d683b3c2><i class="iconfont reco-account" data-v-d683b3c2><span data-v-d683b3c2>Fk</span></i> <i class="iconfont reco-date" data-v-d683b3c2><span data-v-d683b3c2>2021-01-28 22:02:00</span></i> <i class="iconfont reco-eye" data-v-d683b3c2><span id="/views/node/nest_1.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-d683b3c2><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="tags iconfont reco-tag" data-v-d683b3c2><span class="tag-item" data-v-d683b3c2>node</span><span class="tag-item" data-v-d683b3c2>nest</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="什么是-nest"><a href="#什么是-nest" class="header-anchor">#</a> 什么是 Nest</h2> <p><a href="https://user-images.githubusercontent.com/6111778/44448923-46fd4300-a61f-11e8-86ba-f7ba68f708fc.png" target="_blank" rel="noopener noreferrer"><img src="https://user-images.githubusercontent.com/6111778/44448923-46fd4300-a61f-11e8-86ba-f7ba68f708fc.png" alt="nest_logo"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>Nest</code>是一个强大的<code>Node web</code>框架。它可以帮助您轻松地构建高效、可伸缩的应用程序。它使用现代<code>JavaScript</code>，用<code>TypeScript</code>构建，结合了<code>OOP</code>(面向对象编程)和<code>FP</code>(函数式编程)的最佳概念。</p> <p>它不仅仅是另一个框架。你不需要等待一个大的社区，因为<code>Nest</code>是用非常棒的、流行的知名库——<code>Express</code>和<code>socket.io</code>构建的!这意味着，您可以快速开始使用框架，而不必担心第三方插件。</p> <p>作者<a href="http://kamilmysliwiec.com/" target="_blank" rel="noopener noreferrer">Kamil Myśliwiec<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>初衷：</p> <blockquote><p>JavaScript is awesome. Node.js gave us a possibility to use this language also on the server side. There are a lot of amazing libraries, helpers and tools on this platform, but non of them do not solve the main problem – the architecture. This is why I decided to create Nest framework.</p></blockquote> <blockquote><p><strong>重要</strong>：<code>Nest</code> 受到 <code>Java Spring</code> 和 <code>Angular</code> 的启发。如果你用过 <code>Java Spring</code> 或 <code>Angular</code> 就会学起来非常容易，我本人一直使用 <code>Angular</code>。</p></blockquote> <h2 id="nest-核心概念"><a href="#nest-核心概念" class="header-anchor">#</a> Nest 核心概念</h2> <p>Nest的核心概念是提供一种体系结构，它帮助开发人员实现层的最大分离，并在应用程序中增加抽象。</p> <h3 id="架构概览"><a href="#架构概览" class="header-anchor">#</a> 架构概览</h3> <p><code>Nest</code>采用了<code>ES6</code>和<code>ES7</code>的特性(<code>decorator</code>, <code>async/await</code>)。如果想使用它们，需要用到<code>Babel</code>或<code>TypeScript</code>进行转换成 <code>es5</code>。</p> <p><code>Nest</code>默认使用的是<a href="http://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">TypeScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也可以直接使用<code>JavaScript</code>，不过那样就没什么意义了。</p> <blockquote><p>如果你使用过<a href="https://angular.cn/" target="_blank" rel="noopener noreferrer">Angular<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，你来看这篇文章会觉得非常熟悉的感觉，因为它们大部分写法类似。如果你没有用过也没有关系，我将带领你一起学习它们。</p></blockquote> <h3 id="模块-module"><a href="#模块-module" class="header-anchor">#</a> 模块 Module</h3> <p>使用<code>Nest</code>，您可以很自然地将代码拆分为独立的和可重用的模块。<code>Nest</code>模块是一个带有<code>@Module()</code>装饰器的类。这个装饰器提供元数据，框架使用元数据来组织应用程序结构。</p> <p>每个 <code>Nest</code> 应用都有一个根模块，通常命名为 <code>AppModule</code>。根模块提供了用来启动应用的引导机制。 一个应用通常会包含很多功能模块。</p> <p>像 <code>JavaScript</code> 模块一样，<code>@Module</code> 也可以从其它 <code>@Module</code> 中导入功能，并允许导出它们自己的功能供其它 <code>@Module</code> 使用。 比如，要在你的应用中使用<code>nest</code>提供的<code>mongoose</code>操作功能，就需要导入<code>MongooseModule</code>。</p> <p>把你的代码组织成一些清晰的功能模块，可以帮助管理复杂应用的开发工作并实现可复用性设计。 另外，这项技术还能让你使用动态加载，<code>MongooseModule</code>就是使用这项技术。</p> <p><code>@Module</code> 装饰器接受一个对象，该对象的属性描述了模块:</p> <table><thead><tr><th>属性</th> <th>描述</th></tr></thead> <tbody><tr><td><code>providers</code></td> <td>由<code>Nest</code>注入器实例化的服务，可以在这个模块之间共享。</td></tr> <tr><td><code>controllers</code></td> <td>存放创建的一组控制器。</td></tr> <tr><td><code>imports</code></td> <td>导入此模块中所需的提供程序的模块列表。</td></tr> <tr><td><code>exports</code></td> <td>导出这个模块可以其他模块享用<code>providers</code>里的服务。</td></tr></tbody></table> <p><code>@Module</code> 为一个控制器集声明了编译的上下文环境，它专注于某个应用领域、某个工作流或一组紧密相关的能力。 <code>@Module</code> 可以将其控制器和一组相关代码（如服务）关联起来，形成功能单元。</p> <p>怎么组织一个模块结构图</p> <p>AppModule 根模块</p> <ul><li>CoreModule 核心模块（注册中间件，过滤器，管道，守卫，拦截器，装饰器等）</li> <li>SharedModule 共享模块（注册服务，mongodb，redis等）</li> <li>ConfigModule 配置模块（系统配置）</li> <li>FeatureModule 特性模块（业务模块，如用户模块，产品模块等）</li></ul> <p>在<code>Nest</code>中，模块默认是单例的，因此可以在多个模块之间共享任何提供者的同一个实例。共享模块毫不费力。</p> <p>整体看起来比较干净清爽，这也是我在<code>Angular</code>项目中一直使用的模块划分。</p> <p>如果你有更好建议，欢迎和我一起交流改进。</p> <h3 id="控制器-controller"><a href="#控制器-controller" class="header-anchor">#</a> 控制器 Controller</h3> <p>控制器负责处理客户端传入的请求参数并向客户端返回响应数据，说的通俗点就是路由<code>Router</code>。</p> <p>为了创建一个基本的控制器，我们使用<code>@Controller</code>装饰器。它们将类与基本的元数据相关联，因此<code>Nest</code>知道如何将控制器映射到相应的路由。</p> <p><code>@Controller</code>它是定义基本控制器所必需的。<code>@Controller('Router Prefix')</code>是类中注册的每个路由的可选前缀。使用前缀可以避免在所有路由共享一个公共前缀时重复使用自己。</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
    @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">)</span>
    <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//  findAll访问就是  xxx/user</span>
<span class="token comment">//  admin访问就是    xxx/user/admin</span>
</code></pre></div><p>控制器是一个比较核心功能，所有的业务都是围绕它来开展。<code>Nest</code>也提供很多相关的装饰器，接下来一一介绍他们，这里只是简单说明，后面实战会介绍他们的使用。</p> <p>请求对象表示HTTP请求，并具有请求查询字符串、参数、HTTP标头等属性，但在大多数情况下，不需要手动获取它们。我们可以使用专用的<code>decorator</code>，例如<code>@Body()</code>或<code>@Query()</code>，它们是开箱即用的。下面是<code>decorator</code>与普通<code>Express</code>对象的比较。</p> <p>先说方法参数装饰器：</p> <table><thead><tr><th>装饰器名称</th> <th>描述</th></tr></thead> <tbody><tr><td><code>@Request()</code></td> <td>对应<code>Express</code>的<code>req</code>，也可以简写<code>@req</code></td></tr> <tr><td><code>@Response()</code></td> <td>对应<code>Express</code>的<code>res</code>，也可以简写<code>@res</code></td></tr> <tr><td><code>@Next()</code></td> <td>对应<code>Express</code>的<code>next</code></td></tr> <tr><td><code>@Session()</code></td> <td>对应<code>Express</code>的<code>req.session</code></td></tr> <tr><td><code>@Param(param?: string)</code></td> <td>对应<code>Express</code>的<code>req.params</code></td></tr> <tr><td><code>@Body(param?: string)</code></td> <td>对应<code>Express</code>的<code>req.body</code></td></tr> <tr><td><code>@Query(param?: string)</code></td> <td>对应<code>Express</code>的<code>req.query</code></td></tr> <tr><td><code>@Headers(param?: string)</code></td> <td>对应<code>Express</code>的<code>req.headers</code></td></tr></tbody></table> <p>先说方法装饰器：</p> <table><thead><tr><th>装饰器名称</th> <th>描述</th></tr></thead> <tbody><tr><td><code>@Post()</code></td> <td>对应<code>Express</code>的<code>Post</code>方法</td></tr> <tr><td><code>@Get()</code></td> <td>对应<code>Express</code>的<code>Get</code>方法</td></tr> <tr><td><code>@Put()</code></td> <td>对应<code>Express</code>的<code>Put</code>方法</td></tr> <tr><td><code>@Delete()</code></td> <td>对应<code>Express</code>的<code>Delete</code>方法</td></tr> <tr><td><code>@All()</code></td> <td>对应<code>Express</code>的<code>All</code>方法</td></tr> <tr><td><code>@Patch()</code></td> <td>对应<code>Express</code>的<code>Patch</code>方法</td></tr> <tr><td><code>@Options()</code></td> <td>对应<code>Express</code>的<code>Options</code>方法</td></tr> <tr><td><code>@Head()</code></td> <td>对应<code>Express</code>的<code>Head</code>方法</td></tr> <tr><td><code>@Render()</code></td> <td>对应<code>Express</code>的<code>res.render</code>方法</td></tr> <tr><td><code>@Header()</code></td> <td>对应<code>Express</code>的<code>res.header</code>方法</td></tr> <tr><td><code>@HttpCode()</code></td> <td>对应<code>Express</code>的<code>res.status</code>方法，可以配合<code>HttpStatus</code>枚举</td></tr></tbody></table> <p>以上基本都是控制器装饰器，一些常用的HTTP请求参数需要使用对应的方法装饰器和参数来配合使用。</p> <p>关于返回响应数据，<code>Nest</code>也提供2种解决方案：</p> <ol><li>直接返回一个<code>JavaScript</code>对象或数组时，它将被自动解析为<code>JSON</code>。当我们返回一个字符串时，<code>Nest</code>只发送一个字符串，而不尝试解析它。默认情况下，响应的状态代码总是<code>200</code>,
但<code>POST</code>请求除外，它使用<code>201</code>。可以使用<code>@HttpCode(HttpStatus.xxxx)</code>装饰器可以很容易地改变这种行为。</li> <li>我们可以使用库特定的响应对象，我们这里可以使用<a href="https://github.com/res" target="_blank" rel="noopener noreferrer">@res<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>()修饰符在函数签名中注入该对象，
<code>res.status(HttpStatus.CREATED).send()</code>或者<code>res.status(HttpStatus.OK).json([])</code>等<code>Express</code>的<code>res</code>方法。</li></ol> <p><strong>注意</strong>：禁止同时使用这两种方法，如果2个都使用，那么会出现这个路由不工作的情况。如果你在使用时候发现路由不响应，请检查有没有出现混用的情况，如果是正常情况下，推荐第一种方式返回。</p> <blockquote><p>控制器必须注册到该模块元数据的<code>controllers</code>里才能正常工作。</p></blockquote> <p>关于控制器异常处理，在后面过滤器讲解。</p> <h3 id="服务与依赖注入-provider-dependency-injection"><a href="#服务与依赖注入-provider-dependency-injection" class="header-anchor">#</a> 服务与依赖注入 Provider Dependency injection</h3> <p>服务是一个广义的概念，它包括应用所需的任何值、函数或特性。狭义的服务是一个明确定义了用途的类。它应该做一些具体的事，并做好。</p> <p><code>Nest</code> 把控制器和服务区分开，以提高模块性和复用性。</p> <p>通过把控制器中和逻辑有关的功能与其他类型的处理分离开，你可以让控制器类更加精简、高效。 理想情况下，控制器的工作只管申明装饰器和响应数据，而不用顾及其它。 它应该提供请求和响应桥梁，以便作为视图（由模板渲染）和应用逻辑（通常包含一些模型的概念）的中介者。</p> <p>控制器不需要定义任何诸如从客户端获取数据、验证用户输入或直接往控制台中写日志等工作。 而要把这些任务委托给各种服务。通过把各种处理任务定义到可注入的服务类中，你可以让它可以被任何控制器使用。 通过在不同的环境中注入同一种服务的不同提供商，你还可以让你的应用更具适应性。</p> <p><code>Nest</code> 不会强制遵循这些原则。它只会通过依赖注入让你能更容易地将应用逻辑分解为服务，并让这些服务可用于各个控制器中。</p> <p>控制器是服务的消费者，也就是说，你可以把一个服务注入到控制器中，让控制器类得以访问该服务类。</p> <p>那么服务就是提供者，基本上，几乎所有事情都可以看作是提供者—服务、存储库、工厂、助手等等。它们都可以通过构造函数注入依赖关系，这意味着它们可以彼此创建各种关系。</p> <p>在 <code>Nest</code> 中，要把一个类定义为服务，就要用 <code>@Injectable</code> 装饰器来提供元数据，以便让 <code>Nest</code> 可以把它作为依赖注入到控制器中。</p> <p>同样，也要使用 <code>@Injectable</code> 装饰器来表明一个控制器或其它类（比如另一个服务、模块等）拥有一个依赖。 依赖并不必然是服务，它也可能是函数或值等等。</p> <p>依赖注入（通常简称 DI）被引入到 <code>Nest</code> 框架中，并且到处使用它，来为新建的控制器提供所需的服务或其它东西。</p> <p>注入器是主要的机制。你不用自己创建 <code>Nest</code> 注入器。<code>Nest</code> 会在启动过程中为你创建全应用级注入器。</p> <p>该注入器维护一个包含它已创建的依赖实例的容器，并尽可能复用它们。</p> <p>提供者是创建依赖项的配方。对于服务来说，它通常就是这个服务类本身。你在应用中要用到的任何类都必须使用该应用的注入器注册一个提供商，以便注入器可以使用它来创建新实例。</p> <p>关于依赖注入，前端框架<code>Angular</code>应该是最出名的，可以看<a href="https://angular.cn/guide/dependency-injection-pattern" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>介绍。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 用户服务</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> user<span class="token operator">:</span> User<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">create</span><span class="token punctuation">(</span>cat<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> User<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用户控制器</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Body <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>自定义服务</p> <p>我们不光可以使用<code>@Injectable()</code>来定义服务，还可以使用其他三种方式：<code>value</code>、<code>class</code>、<code>factory</code>。
这个和Angular一样，默认<code>@Injectable()</code>来定义服务就是<code>class</code>。</p> <p>使用<code>value</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> customObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    controllers<span class="token operator">:</span> <span class="token punctuation">[</span> UsersController <span class="token punctuation">]</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> UsersService<span class="token punctuation">,</span> useValue<span class="token operator">:</span> customObject <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><strong>注意</strong>：<code>useValue</code>可以是任何值，在这个模块中，<code>Nest</code>将把<code>customObject</code>与<code>UsersService</code>相关联，你还可以使用做测试替身(单元测试)。</p></blockquote> <p>使用<code>class</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> customObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    controllers<span class="token operator">:</span> <span class="token punctuation">[</span> UsersController <span class="token punctuation">]</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> UsersService<span class="token punctuation">,</span> useClass<span class="token operator">:</span> UserService <span class="token punctuation">}</span>
        <span class="token constant">OR</span>
        UserService
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><strong>注意</strong>：只需要在本模块中使用选定的、更具体的类，<code>useClass</code>可以是和<code>provide</code>一样，如果不一样就相当于<code>useClass</code>替换<code>provide</code>。简单理解换方法，不换方法名，常用处理不同环境依赖注入。</p></blockquote> <p>使用<code>factory</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    controllers<span class="token operator">:</span> <span class="token punctuation">[</span> UsersController <span class="token punctuation">]</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span> <span class="token punctuation">[</span>
        ChatService<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            provide<span class="token operator">:</span> UsersService<span class="token punctuation">,</span>
            <span class="token function-variable function">useFactory</span><span class="token operator">:</span> <span class="token punctuation">(</span>chatService<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> Observable<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">'customValue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            inject<span class="token operator">:</span> <span class="token punctuation">[</span> ChatService <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><strong>注意</strong>：希望提供一个值，该值必须使用其他组件(或自定义包特性)计算，希望提供异步值(只返回可观察的或承诺的值)，例如数据库连接。<code>inject</code>依赖服务，<code>provide</code>注册名，<code>useFactory</code>处理方式，<code>useFactory</code>参数和<code>inject</code>注入数组顺序一样。</p></blockquote> <p>如果我们<code>provide</code>注册名不是一个服务怎么办，是一个字符串<code>key</code>，也是很常用的。</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    controllers<span class="token operator">:</span> <span class="token punctuation">[</span> UsersController <span class="token punctuation">]</span><span class="token punctuation">,</span>
    components<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> <span class="token string">'isProductionMode'</span><span class="token punctuation">,</span> useValue<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>要用选择的自定义字符串<code>key</code>，您必须告诉Nest，需要用到<code>@Inject()</code>装饰器，就像这样:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nest.js'</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SampleComponent</span> <span class="token punctuation">{</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>@<span class="token function">Inject</span><span class="token punctuation">(</span><span class="token string">'isProductionMode'</span><span class="token punctuation">)</span> <span class="token keyword">private</span> isProductionMode<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>isProductionMode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>还有一个循环依赖的坑，后面实战会介绍怎么避免和解决这个坑。</p> <blockquote><p>服务必须注册到该模块元数据的<code>providers</code>里才能正常工作。如果需要给其他模块使用，需要添加到<code>exports</code>中。</p></blockquote> <h3 id="中间件-middleware"><a href="#中间件-middleware" class="header-anchor">#</a> 中间件 Middleware</h3> <p>中间件是在路由处理程序之前调用的函数。中间件功能可以访问请求和响应对象，以及应用程序请求-响应周期中的下一个中间件功能。下一个中间件函数通常由一个名为<code>next</code>的变量表示。在<code>Express</code>中的中间件是非常出名的。</p> <p>默认情况下，<code>Nest</code>中间件相当于表示<code>Express</code>中间件。和<code>Express</code>中间件功能类似，中间件功能可以执行以下任务</p> <ul><li>执行任何代码。</li> <li>对请求和响应对象进行更改。</li> <li>请求-响应周期结束。</li> <li>调用堆栈中的下一个中间件函数。</li> <li>如果当前中间件函数没有结束请求-响应周期，它必须调用<code>next()</code>将控制权传递给下一个中间件函数。否则，请求将被挂起。</li></ul> <p>简单理解<code>Nest</code>中间件就是把<code>Express</code>中间件进行了包装。那么好处就是只要你想用中间件，可以立马搜索<code>Express</code>中间件，拿来即可使用。是不是很方便。</p> <p><code>Nest</code>中间件要么是一个函数，要么是一个带有<code>@Injectable()</code>装饰器的类。类应该实现<code>NestMiddleware</code>接口，而函数却没有任何特殊要求。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 实现一个带有`@Injectable()`装饰器的类打印中间件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> NestMiddleware<span class="token punctuation">,</span> MiddlewareFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LoggerMiddleware</span> <span class="token keyword">implements</span> <span class="token class-name">NestMiddleware</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> MiddlewareFunction <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>怎么使用，有两种方式：</p> <ol><li>中间件可以全局注册</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建Nest.js实例</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">,</span> application<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    bodyParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册中间件</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">LoggerMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 监听3000端口</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>中间件可以模块里局部注册</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CnodeModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span>
      <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">'ApplicationModule'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">exclude</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span> method<span class="token operator">:</span> RequestMethod<span class="token punctuation">.</span><span class="token constant">GET</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span> method<span class="token operator">:</span> RequestMethod<span class="token punctuation">.</span><span class="token constant">POST</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span>UserController<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// or</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CnodeModule</span> <span class="token keyword">implements</span> <span class="token class-name">NestModule</span> <span class="token punctuation">{</span>
  <span class="token function">configure</span><span class="token punctuation">(</span>consumer<span class="token operator">:</span> MiddlewareConsumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">consumer</span>
      <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>LoggerMiddleware<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forRoutes</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 1. with是提供数据，resolve里可以获取，exclude指定的路由，forRoutes注册路由，</span>
<span class="token comment">// 2. forRoutes传递'*'表示作用全部路由</span>
</code></pre></div><blockquote><p><strong>注意</strong>：他们注册地方不一样，影响的路由也不一样，全局注册影响全部路由，局部注册只是影响当前路由下的路由。</p></blockquote> <h3 id="过滤器-exception-filter"><a href="#过滤器-exception-filter" class="header-anchor">#</a> 过滤器 Exception filter</h3> <p>异常过滤器层负责在整个应用程序中处理所有抛出的异常。当发现未处理的异常时，最终用户将收到适当的用户友好响应。</p> <p>默认显示响应<code>JSON</code>信息</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;statusCode&quot;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
  <span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Internal server error&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用底层过滤器</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createCatDto<span class="token operator">:</span> CreateCatDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpException</span><span class="token punctuation">(</span><span class="token string">'Forbidden'</span><span class="token punctuation">,</span> HttpStatus<span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>HttpException 接受2个参数：</p> <ul><li>消息内容，可以是字符串错误消息或者对象<code>{status: 状态码，error：错误消息}</code></li> <li>状态码</li></ul> <p>每次写这么多很麻烦，那么过滤器也支持扩展和定制快捷过滤器对象。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ForbiddenException</span> <span class="token keyword">extends</span> <span class="token class-name">HttpException</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">'Forbidden'</span><span class="token punctuation">,</span> HttpStatus<span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>就可以直接使用了：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createCatDto<span class="token operator">:</span> CreateCatDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ForbiddenException</span><span class="token punctuation">(</span><span class="token string">'Forbidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>是不是，方便很多了。</p> <p><code>Nest</code>给我们提供很多这样快捷常用的HTTP状态错误：</p> <ul><li>BadRequestException 400</li> <li>UnauthorizedException 401</li> <li>ForbiddenException 403</li> <li>NotFoundException 404</li> <li>NotAcceptableException 406</li> <li>RequestTimeoutException 408</li> <li>ConflictException 409</li> <li>GoneException 410</li> <li>PayloadTooLargeException 413</li> <li>UnsupportedMediaTypeException 415</li> <li>UnprocessableEntityException 422</li> <li>InternalServerErrorException 500</li> <li>NotImplementedException 501</li> <li>BadGatewayException 502</li> <li>ServiceUnavailableException 503</li> <li>GatewayTimeoutException 504</li></ul> <p>异常处理程序基础很好,但有时你可能想要完全控制异常层,例如,添加一些日志记录或使用一个不同的<code>JSON</code>模式基于一些选择的因素。前面说了，<code>Nest</code>给我们内置返回响应模板，这个不能接受的，我们要自定义怎么办了，<code>Nest</code>给我们扩展空间。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ExceptionFilter<span class="token punctuation">,</span> Catch<span class="token punctuation">,</span> ArgumentsHost <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpException <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

@<span class="token function">Catch</span><span class="token punctuation">(</span>HttpException<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">HttpExceptionFilter</span> <span class="token keyword">implements</span> <span class="token class-name">ExceptionFilter</span> <span class="token punctuation">{</span>
  <span class="token keyword">catch</span><span class="token punctuation">(</span>exception<span class="token operator">:</span> HttpException<span class="token punctuation">,</span> host<span class="token operator">:</span> ArgumentsHost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ctx <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    response
      <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        statusCode<span class="token operator">:</span> status<span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它返回是一个<code>Express</code>的方法<code>response</code>，来定制自己的响应异常格式。</p> <p>怎么使用，有四种方式：</p> <ol><li>直接<code>@UseFilters()</code>装饰器里面使用，作用当前这条路由的响应结果</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">UseFilters</span><span class="token punctuation">(</span>HttpExceptionFilter <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">HttpExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createCatDto<span class="token operator">:</span> CreateCatDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ForbiddenException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>直接<code>@UseFilters()</code>装饰器里面使用，作用当前控制器路由所有的响应结果</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">UseFilters</span><span class="token punctuation">(</span>HttpExceptionFilter <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">HttpExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsController</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol><li>在全局注册使用内置实例方法<code>useGlobalFilters</code>，作用整个项目。过滤器这种比较通用推荐全局注册。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApplicationModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalFilters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="管道-pipe"><a href="#管道-pipe" class="header-anchor">#</a> 管道 Pipe</h3> <p>管道可以把你的请求参数根据特定条件验证类型、对象结构或映射数据。管道是一个纯函数，不应该从数据库中选择或调用任何服务操作。</p> <p>定义一个简单管道：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PipeTransform<span class="token punctuation">,</span> Injectable<span class="token punctuation">,</span> ArgumentMetadata <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ValidationPipe</span> <span class="token keyword">implements</span> <span class="token class-name">PipeTransform</span> <span class="token punctuation">{</span>
  <span class="token function">transform</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> metadata<span class="token operator">:</span> ArgumentMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>管道是用<code>@Injectable()</code>装饰器注释的类。应该实现<code>PipeTransform</code>接口，具体代码在<code>transform</code>实现，这个和<code>Angular</code>很像。</p> <p><code>Nest</code>处理请求数据验证，在数据不正确时可以抛出异常，使用过滤器来捕获。</p> <p><code>Nest</code>为我们内置了2个通用的管道，一个数据验证<code>ValidationPipe</code>，一个数据转换<code>ParseIntPipe</code>。</p> <p>使用<code>ValidationPipe</code>需要配合<code>class-validator class-transformer</code>，如果你不安装它们 ，你使用<code>ValidationPipe</code>会报错的。</p> <blockquote><p><strong>提示</strong>：<code>ValidationPipe</code>不光可以验证请求数据也做数据类型转换，这个可以看官网。</p></blockquote> <p>怎么使用，有四种方式</p> <ol><li>直接<code>@Body()</code>装饰器里面使用，只作用当前body这个参数</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 用户控制器</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Body <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span>ValidationPipe <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>在<code>@UsePipes()</code>装饰器里面使用，作用当前这条路由所有的请求参数</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 用户控制器</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Body <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">UsePipes</span><span class="token punctuation">(</span>ValidationPipe <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>在<code>@UsePipes()</code>装饰器里面使用，作用当前控制器路由所有的请求参数</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 用户控制器</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Body <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.service'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
@<span class="token function">UsePipes</span><span class="token punctuation">(</span>ValidationPipe <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>在全局注册使用内置实例方法<code>useGlobalPipes</code>，作用整个项目。这个管道比较通用推荐全局注册。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApplicationModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalPipes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ValidationPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>那么<code>createUserDto</code>怎么玩了，后面实战教程会讲解，这里不展开。</p> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">findOne</span><span class="token punctuation">(</span>@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> ParseIntPipe <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">ParseIntPipe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>catsService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>ParseIntPipe</code>使用也很简单，就是把一个字符串转换成数字。也是比较常用的，特别是你的id是字符串数字的时候，用<code>get</code>，<code>put</code>，<code>patch</code>，<code>delete</code>等请求，有id时候特别好用了。
还可以做分页处理，后面实战中用到，具体在讲解。</p> <h3 id="守卫-guard"><a href="#守卫-guard" class="header-anchor">#</a> 守卫 Guard</h3> <p>守卫可以做权限认证，如果你没有权限可以拒绝你访问这个路由，默认返回<code>403</code>错误。</p> <p>定义一个简单管道：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> CanActivate<span class="token punctuation">,</span> ExecutionContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthGuard</span> <span class="token keyword">implements</span> <span class="token class-name">CanActivate</span> <span class="token punctuation">{</span>
  <span class="token function">canActivate</span><span class="token punctuation">(</span>
    context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Observable<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">switchToHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">validateRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>守卫是用<code>@Injectable()</code>装饰器注释的类。应该实现<code>CanActivate</code>接口，具体代码在<code>canActivate</code>方法实现，返回一个布尔值，true就表示有权限，false抛出异常403错误。这个写法和<code>Angular</code>很像。</p> <p>怎么使用，有两种方式</p> <ol><li>直接<code>@UseGuards()</code>装饰器里面使用，作用当前控制器路由所有的请求参数</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
@<span class="token function">UseGuards</span><span class="token punctuation">(</span>RolesGuard <span class="token operator">|</span> <span class="token keyword">new</span> <span class="token class-name">RolesGuard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsController</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol><li>在全局注册使用内置实例方法<code>useGlobalGuards</code>，作用整个项目。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApplicationModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">useGlobalGuards</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RolesGuard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果你不做权限管理相关的身份验证操作，基本用不上这个功能。不过还是很有用抽象功能。我们这个实战项目也会用到这个功能。</p> <h3 id="拦截器-interceptor"><a href="#拦截器-interceptor" class="header-anchor">#</a> 拦截器 Interceptor</h3> <p>拦截器是一个比较特殊强大功能，类似于AOP面向切面编程，前端编程中也尝尝使用这样的技术，比如各种http请求库都提供类似功能。有名的框架<code>Angular</code>框架HTTP模块。有名的库有老牌的<code>jquery</code>和新潮的<code>axios</code>等。</p> <p>定义一个简单拦截器：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> NestInterceptor<span class="token punctuation">,</span> ExecutionContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> tap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LoggingInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">NestInterceptor</span> <span class="token punctuation">{</span>
  <span class="token function">intercept</span><span class="token punctuation">(</span>
    context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">,</span>
    call$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Before...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> call$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">After... </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>拦截器是用<code>@Injectable()</code>装饰器注释的类。应该实现<code>NestInterceptor</code>接口，具体代码在<code>intercept</code>方法实现，返回一个<code>Observable</code>，这个写法和<code>Angular</code>很像。</p> <p>拦截器可以做什么：</p> <ul><li>在方法执行之前/之后绑定额外的逻辑</li> <li>转换从函数返回的结果</li> <li>转换从函数抛出的异常</li> <li>扩展基本的函数行为</li> <li>完全覆盖一个函数取决于所选择的条件(例如缓存)</li></ul> <p>怎么使用，有三种方式</p> <ol><li>直接<code>@UseInterceptors()</code>装饰器里面使用，作用当前路由，还可以传参数，需要特殊处理，写成高阶函数，也可以使用依赖注入。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span>
@<span class="token function">UseInterceptors</span><span class="token punctuation">(</span>FileFieldsInterceptor <span class="token operator">|</span> <span class="token function">FileFieldsInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'avatar'</span><span class="token punctuation">,</span> maxCount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'background'</span><span class="token punctuation">,</span> maxCount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">uploadFile</span><span class="token punctuation">(</span>@<span class="token function">UploadedFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>直接<code>@UseInterceptors()</code>装饰器里面使用，作用当前控制器路由，这个不能传参数，可以使用依赖注入</li></ol> <div class="language- extra-class"><pre class="language-text"><code>@UseInterceptors(LoggingInterceptor | new LoggingInterceptor())
export class CatsController {}
</code></pre></div><ol><li>在全局注册使用内置实例方法<code>useGlobalInterceptors</code>，作用整个项目。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApplicationModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">useGlobalInterceptors</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>拦截器可以做很多功能，比如缓存处理，响应数据转换，异常捕获转换，响应超时跑错，打印请求响应日志。我们这个实战项目也会用到这个功能。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>模块是按业务逻辑划分基本单元，包含控制器和服务。控制器是处理请求和响应数据的部件，服务处理实际业务逻辑的部件。</p> <p>中间件是路由处理Handler前的数据处理层，只能在模块或者全局注册，可以做日志处理中间件、用户认证中间件等处理，中间件和express的中间件一样，所以可以访问整个request、response的上下文，模块作用域可以依赖注入服务。全局注册只能是一个纯函数或者一个高阶函数。</p> <p>管道是数据流处理，在中间件后路由处理前做数据处理，可以控制器中的类、方法、方法参数、全局注册使用，只能是一个纯函数。可以做数据验证，数据转换等数据处理。</p> <p>守卫是决定请求是否可以到达对应的路由处理器，能够知道当前路由的执行上下文，可以控制器中的类、方法、全局注册使用，可以做角色守卫。</p> <p>拦截器是进入控制器之前和之后处理相关逻辑，能够知道当前路由的执行上下文，可以控制器中的类、方法、全局注册使用，可以做日志、事务处理、异常处理、响应数据格式等。</p> <p>过滤器是捕获错误信息，返回响应给客户端。可以控制器中的类、方法、全局注册使用，可以做自定义响应异常格式。</p> <p>中间件、过滤器、管道、守卫、拦截器，这是几个比较容易混淆的东西。他们有个共同点都是和控制器挂钩的中间抽象处理层，但是他们的职责却不一样。</p> <p>全局管道、守卫、过滤器和拦截器和任何模块松散耦合。他们不能依赖注入任何服务，因为他们不属于任何模块。
可以使用控制器作用域、方法作用域或辅助作用域仅由管道支持，其他除了中间件是模块作用域，都是控制器作用域和方法作用域。</p> <blockquote><p><strong>重点</strong>：在示例给出了它们的写法，注意全局管道、守卫、过滤器和拦截器，只能new，全局中间件是纯函数，全局管道、守卫、过滤器和拦截器，中间件都不能依赖注入。中间件模块注册也不能用new，可以依赖注入。管道、守卫、过滤器和拦截器局部注册可以使用new和类名，除了管道以为其他都可以依赖注入。拦截器和守卫可以写成高阶方法来传参，达到定制目的。</p></blockquote> <p>管道、过滤器、拦截器守卫都有各自的具体职责。拦截器和守卫与模块结合在一起，而管道和过滤器则运行在模块区域之外。管道任务是根据特定条件验证类型、对象结构或映射数据。过滤器任务是捕获各种错误返回给客户端。管道不是从数据库中选择或调用任何服务的适当位置。另一方面来说，拦截器不应该验证对象模式或修饰数据。如果需要重写，则必须由数据库调用服务引起。守卫决定了哪些路由可以访问，它接管你的验证责任。</p> <p>那你肯定最关心他们执行顺序是什么：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>客户端请求 ---<span class="token operator">&gt;</span> 中间件 ---<span class="token operator">&gt;</span> 守卫 ---<span class="token operator">&gt;</span> 拦截器之前 ---<span class="token operator">&gt;</span> 管道 ---<span class="token operator">&gt;</span> 控制器处理并响应 ---<span class="token operator">&gt;</span> 拦截器之后 ---<span class="token operator">&gt;</span> 过滤器
</code></pre></div><p>我们来看2张图，</p> <p>请求返回响应结果：</p> <p><a href="https://user-images.githubusercontent.com/6111778/44449059-a3f8f900-a61f-11e8-9414-15ae4fe6f312.png" target="_blank" rel="noopener noreferrer"><img src="https://user-images.githubusercontent.com/6111778/44449059-a3f8f900-a61f-11e8-9414-15ae4fe6f312.png" alt="hdvo ug9_58 g 9o_n n 7o"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>请求返回响应异常：</p> <p><a href="https://user-images.githubusercontent.com/6111778/44449066-a9eeda00-a61f-11e8-92c4-8aca90649f53.png" target="_blank" rel="noopener noreferrer"><img src="https://user-images.githubusercontent.com/6111778/44449066-a9eeda00-a61f-11e8-92c4-8aca90649f53.png" alt="nmzgsgsc5ynm_ghfsxzl5jh"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="hello-world"><a href="#hello-world" class="header-anchor">#</a> Hello World</h2> <p>学习一门语言一门技术都是从 <code>Hello World</code> 开始，我们也是从零到<code>Hello World</code>开启学习<code>Nest</code>之旅</p> <h3 id="准备必备开发环境和工具"><a href="#准备必备开发环境和工具" class="header-anchor">#</a> 准备必备开发环境和工具</h3> <p>推荐<code>nvm</code>来管理<code>nodejs</code>版本，根据自己电脑下载对应版本吧。</p> <ol><li><p>准备环境: <a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Nodejs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> v8+ (目前版本v10+, 必须8以上，对es2015支持率很高)</p></li> <li><p>准备数据库：<a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">mongodb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> v3+ (目前版本v4+)</p></li> <li><p>准备数据库：<a href="https://redis.io/" target="_blank" rel="noopener noreferrer">redis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> v3+ (目前版本v3+)</p></li> <li><p>准备编辑器: <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">vs code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 最新版即可(本机 windows v1.26)</p></li> <li><div class="language-bash extra-class"><pre class="language-bash"><code>vs code
</code></pre></div><p>推荐插件：(其他插件自己随意)</p> <ul><li>Debugger for Chrome -- 调试</li> <li>ejs -- ejs文件高亮</li> <li>Beautify -- 代码格式化</li> <li>DotENV -- .env文件高亮</li> <li>Jest -- nest默认测试框架支持</li> <li>TSLint -- ts语法检查</li> <li>TypeScript Hero -- ts提示</li> <li>vscode-icons -- icons</li></ul></li> <li><p>推荐几个好用的工具：</p> <ul><li>Postmen -- API测试神器</li> <li>Robomongo -- mongodb图形化工具</li> <li>Redis Desktop Manager -- Redis图形化工具</li> <li>Cmder -- Windows命令行神器</li></ul></li></ol> <h3 id="nest相关资源"><a href="#nest相关资源" class="header-anchor">#</a> Nest相关资源</h3> <ol><li>官网：<a href="https://nestjs.com/" target="_blank" rel="noopener noreferrer">https://nestjs.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>文档：<a href="https://docs.nestjs.com/" target="_blank" rel="noopener noreferrer">https://docs.nestjs.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>中文文档：<a href="https://docs.nestjs.cn/" target="_blank" rel="noopener noreferrer">https://docs.nestjs.cn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Github：https://github.com/nestjs/nest</li> <li>版本：目前稳定版v5.1.0</li> <li>CLI：https://github.com/nestjs/nest-cli</li></ol> <h3 id="nest-cli"><a href="#nest-cli" class="header-anchor">#</a> nest-cli</h3> <p><code>nest-cli</code> 是一个 <code>nest</code> 项目脚手架。为我们提供一个初始化模块，可以让我们快速完成<code>Hello World</code>功能。</p> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i -g @nestjs/cli
</code></pre></div><h4 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令：</h4> <h5 id="new-简写-n-构建新项目"><a href="#new-简写-n-构建新项目" class="header-anchor">#</a> new(简写：n) 构建新项目</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>$ nest new my-awesome-app
OR
$ nest n my-awesome-app
</code></pre></div><h5 id="generate-简写-g-生成文件"><a href="#generate-简写-g-生成文件" class="header-anchor">#</a> generate(简写：g) 生成文件</h5> <ul><li>class (简写: cl) 类</li> <li>controller (简写: co) 控制器</li> <li>decorator (简写: d) 装饰器</li> <li>exception (简写: e) 异常捕获</li> <li>filter (简写: f) 过滤器</li> <li>gateway (简写: ga) 网关</li> <li>guard (简写: gu) 守卫</li> <li>interceptor (简写: i) 拦截器</li> <li>middleware (简写: mi) 中间件</li> <li>module (简写: mo) 模块</li> <li>pipe (简写: pi) 管道</li> <li>provider (简写: pr) 供应商</li> <li>service (简写: s) 服务</li></ul> <p>创建一个users服务文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ nest generate <span class="token function">service</span> <span class="token function">users</span>
OR
$ nest g s <span class="token function">users</span>
</code></pre></div><blockquote><p><strong>注意</strong>：</p></blockquote> <ol><li><code>必须</code>在项目<code>根目录</code>下创建，（默认创建在src/）。（不能在当前文件夹里面创建，不然会自动生成xxx/src/xxx。吐槽：这个没有Angular-cli智能）</li> <li>需要<code>优先</code>新建模块，不然创建的非模块以外的服务，控制器等就会自动注入更新到上级的模块里面</li></ol> <h5 id="info-简写-i-打印版本信息"><a href="#info-简写-i-打印版本信息" class="header-anchor">#</a> info(简写：i) 打印版本信息</h5> <p>打印当前系统，使用nest核心模块版本，供你去官方提交<a href="https://github.com/nestjs/nest/issues" target="_blank" rel="noopener noreferrer">issues<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">|</span> <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span>           <span class="token operator">|</span> <span class="token operator">|</span>    <span class="token operator">|</span>_  <span class="token operator">|</span>/  ___<span class="token operator">|</span>/  __ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span>   <span class="token operator">|</span>_   _<span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span>  ___  ___ <span class="token operator">|</span> <span class="token operator">|</span>_     <span class="token operator">|</span> <span class="token operator">|</span><span class="token punctuation">\</span> <span class="token variable"><span class="token variable">`</span>--. <span class="token operator">|</span> /  <span class="token punctuation">\</span>/<span class="token operator">|</span> <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">.</span> <span class="token variable">`</span></span> <span class="token operator">|</span> / _ <span class="token punctuation">\</span>/ __<span class="token operator">||</span> __<span class="token operator">|</span>    <span class="token operator">|</span> <span class="token operator">|</span> `--. <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span>    <span class="token operator">|</span> <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token operator">|</span><span class="token punctuation">\</span>  <span class="token operator">||</span>  __/<span class="token punctuation">\</span>__ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span>_ /<span class="token punctuation">\</span>__/ //<span class="token punctuation">\</span>__/ /<span class="token operator">|</span> <span class="token punctuation">\</span>__/<span class="token punctuation">\</span><span class="token operator">|</span> <span class="token operator">|</span>_____<span class="token operator">|</span> <span class="token operator">|</span>_
<span class="token punctuation">\</span>_<span class="token operator">|</span> <span class="token punctuation">\</span>_/ <span class="token punctuation">\</span>___<span class="token operator">||</span>___/ <span class="token punctuation">\</span>__<span class="token operator">|</span><span class="token punctuation">\</span>____/ <span class="token punctuation">\</span>____/  <span class="token punctuation">\</span>____/<span class="token punctuation">\</span>_____/<span class="token punctuation">\</span>___/


<span class="token punctuation">[</span>System Information<span class="token punctuation">]</span>
OS Version     <span class="token builtin class-name">:</span> Windows <span class="token number">10</span>
NodeJS Version <span class="token builtin class-name">:</span> v8.11.1
NPM Version    <span class="token builtin class-name">:</span> <span class="token number">5.6</span>.0
<span class="token punctuation">[</span>Nest Information<span class="token punctuation">]</span>
microservices version <span class="token builtin class-name">:</span> <span class="token number">5.1</span>.0
websockets version    <span class="token builtin class-name">:</span> <span class="token number">5.1</span>.0
testing version       <span class="token builtin class-name">:</span> <span class="token number">5.1</span>.0
common version        <span class="token builtin class-name">:</span> <span class="token number">5.1</span>.0
core version          <span class="token builtin class-name">:</span> <span class="token number">5.1</span>.0
</code></pre></div><blockquote><p>最后，整体功能和<code>Angular-cli</code>类似，比较简单实用功能。构建项目，生成文件，打印版本信息。</p></blockquote> <h3 id="nest内置功能"><a href="#nest内置功能" class="header-anchor">#</a> nest内置功能</h3> <p>目前<code>Nest.js</code>支持 <code>express</code> 和 <code>fastify</code>, 对 <code>fastify</code> 不熟，本文选择<code>express</code>。</p> <h4 id="核心模块"><a href="#核心模块" class="header-anchor">#</a> 核心模块</h4> <ul><li>@nestjs/common 提供很多装饰器，log服务等</li> <li>@nestjs/core 核心模块处理底层框架兼容</li> <li>@nestjs/microservices 微服务支持</li> <li>@nestjs/testing 测试套件</li> <li>@nestjs/websockets websocket支持</li></ul> <h4 id="可选模块"><a href="#可选模块" class="header-anchor">#</a> 可选模块</h4> <ul><li>@nestjs/typeorm 还没玩过</li> <li>@nestjs/graphql 还没玩过</li> <li>@nestjs/cqrs 还没玩过</li> <li>@nestjs/passport 身份验证（v5版支持，不向下兼容）</li> <li>@nestjs/swagger swagger UI API</li> <li>@nestjs/mongoose mongoose模块</li></ul> <blockquote><p><strong>注意</strong>: 其他中间件模块，只要支持<code>express</code>和都可以使用。</p></blockquote> <h3 id="构建项目"><a href="#构建项目" class="header-anchor">#</a> 构建项目</h3> <ol><li>创建项目<code>nest-cnode</code></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>nest new nest-cnode
</code></pre></div><p><a href="https://user-images.githubusercontent.com/6111778/44448993-7318c400-a61f-11e8-9201-0d099d6f5d24.png" target="_blank" rel="noopener noreferrer"><img src="https://user-images.githubusercontent.com/6111778/44448993-7318c400-a61f-11e8-9201-0d099d6f5d24.png" alt="nest_cli"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>其中提交的你的<code>description</code>, 初始化版本<code>version</code>, 作者<code>author</code>, 以及一个<code>package manager</code>选择<code>node_modules</code>安装方式 <code>npm</code> 或者 <code>yarn</code>。</p> <ol><li>项目启动</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> nest-cnode

// 启动命令

<span class="token function">npm</span> run start  // 预览
<span class="token function">npm</span> run start:dev // 开发
<span class="token function">npm</span> run prestart:prod  // 编译成js
<span class="token function">npm</span> run start:prod  // 生产

// 测试命令

<span class="token function">npm</span> run <span class="token builtin class-name">test</span>  // 单元测试
<span class="token function">npm</span> run test:cov  // 单元测试+覆盖率生成
<span class="token function">npm</span> run test:e2e  // E2E测试
</code></pre></div><ol><li>项目文件介绍</li></ol> <table><thead><tr><th>文件</th> <th>说明</th></tr></thead> <tbody><tr><td>node_modules</td> <td>npm包</td></tr> <tr><td>src</td> <td>源码</td></tr> <tr><td>logs</td> <td>日志</td></tr> <tr><td>test</td> <td>E2E测试</td></tr> <tr><td>views</td> <td>模板</td></tr> <tr><td>public</td> <td>静态资源</td></tr> <tr><td>nodemon.json</td> <td>nodemon配置（npm run start:dev启动）</td></tr> <tr><td>package.json</td> <td>npm包管理</td></tr> <tr><td>README.md</td> <td>说明文件</td></tr> <tr><td>tsconfig.json</td> <td>Typescript配置文件（Typescript必备）</td></tr> <tr><td>tslint.json</td> <td>Typescript风格检查文件（Typescript必备）</td></tr> <tr><td>webpack.config.js</td> <td>热更新（npm run start:hmr启动）</td></tr> <tr><td>.env</td> <td>配置文件</td></tr></tbody></table> <blockquote><p>开发代码都在<code>src</code>里，生成代码在<code>dist</code> (打包自动编译)，<code>typescript</code>打包只会编译<code>ts</code>到<code>dist</code> 下，静态文件<code>public</code>和模板<code>views</code>不会移动，所以需要放到根目录下。</p></blockquote> <p><a href="https://user-images.githubusercontent.com/6111778/44449023-8b88de80-a61f-11e8-8f5e-ae3760859942.png" target="_blank" rel="noopener noreferrer"><img src="https://user-images.githubusercontent.com/6111778/44449023-8b88de80-a61f-11e8-8f5e-ae3760859942.png" alt="nest_start"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>我们打开浏览器，访问<code>http://localhost:3000</code>，您应该看到一个页面，上面显示<code>Hello World</code>文字。</p> <p><a href="https://user-images.githubusercontent.com/6111778/44449034-92afec80-a61f-11e8-9dc8-3e8a0160b978.png" target="_blank" rel="noopener noreferrer"><img src="https://user-images.githubusercontent.com/6111778/44449034-92afec80-a61f-11e8-9dc8-3e8a0160b978.png" alt="j _ 2k2q0pqpjt 03o t16u"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/jiayisheji/blog/issues/18" target="_blank" rel="noopener noreferrer">本文来自 https://github.com/jiayisheji/blog/issues/18<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/31/2021, 8:20:29 PM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><div id="goTop" class="hide-cat" data-v-bf92849a></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      我是blackCat欢迎你的关注 
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="160" height="272" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><APlayer audio="" fixed="true" autoplay="autoplay" theme="#b7daff" loop="loop" order="list" preload="auto" volume="0.7" mutex="true" lrc-type="0" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/assets/js/app.4aa0e8ea.js" defer></script><script src="/assets/js/4.3a6b897f.js" defer></script><script src="/assets/js/1.97f2804a.js" defer></script><script src="/assets/js/2.13201674.js" defer></script><script src="/assets/js/41.24ea1bda.js" defer></script>
  </body>
</html>
